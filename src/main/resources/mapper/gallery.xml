<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.backend.gallery.model.mapper.GalleryMapper">
	<resultMap type="galleryDto" id="galleryMap">
		<result column="gallery_title" property="galleryTitle"></result>
		<result column="gallery_no" property="galleryNo"></result>
		<result column="gallery_type" property="galleryType"></result>
		<result column="gallery_reg_time" property="galleryRegTime"></result>
	</resultMap>
	
	<resultMap type="GalleryImageDto" id="GalleryImageMap">
		<result column="image_uri" property="imageUri"></result>
		<result column="gallery_no" property="galleryNo"></result>
		<result column="position" property="position"></result>
	</resultMap>
	
	<resultMap type="GalleryVideoDto" id="GalleryVideoMap">
		<result column="video_uri" property="videoUri"></result>
		<result column="gallery_no" property="galleryNo"></result>
		<result column="position" property="position"></result>
	</resultMap>
	
	<insert id="insertGallery" parameterType="galleryDto">
		insert into gallerys(
			gallery_title,
			gallery_type
		) values(
			#{galleryTitle},
			#{galleryType}
		)
		<selectKey resultType="int" keyProperty="galleryNo" order="AFTER">
			select last_insert_id()
		</selectKey>
	</insert>
	
	<insert id="insertGalleryVideo" parameterType="galleryVideoDto">
		insert into gallery_video(
			video_uri,
			gallery_no,
			position
		) values(
			#{videoUri},
			#{galleryNo},
			#{position}
		)
	</insert>
	
	<insert id="insertGalleryImage" parameterType="galleryImageDto">
	insert into gallery_image(
			image_uri,
			gallery_no,
			position
		) values(
			#{imageUri},
			#{galleryNo},
			#{position}
		)
	</insert> 
	<select id="selectGallery" parameterType="map" resultMap="galleryMap">
		select * from gallerys 
		where gallery_type=#{type}
		limit #{start},#{count}
	</select>
	
	<select id="selectOneGalleryImageByGalleryNo" parameterType="int" resultMap="GalleryImageMap">
		select * from gallery_image 
		where gallery_no=#{galleryNo}
		order by position asc 
		limit 1;
	</select>
	<select id="selectOneGalleryVideoByGalleryNo" parameterType="int" resultMap="GalleryVideoMap">
		select * from gallery_video 
		where gallery_no=#{galleryNo}
		order by position asc 
		limit 1;
	</select>
</mapper>